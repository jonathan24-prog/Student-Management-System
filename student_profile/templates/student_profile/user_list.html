{% extends 'student_profile/basemenu.html' %}


{%block content%}

<div id="app" style="padding: 20px 20px;">
    <div class="semipolar-spinner" v-show="isLoading">
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="ring"></div>
        <br>
        <br>
        <br>
        <p>Feching</p>
    </div>
    <el-card>
        <h4>Search Student Users</h4>
        <hr>

        <el-row :gutter="5">
            <el-col :md="8">
                <el-select v-model="studentNameFilter" filterable remote reserve-keyword
                    placeholder="Enter Name or student ID" :remote-method="searchStudent" :loading="loadingSearch"
                    size="small" style="width: 100%;">
                    <el-option v-for="item in students" :key="item.id" :label="getFullname(item)"
                        :value="item.student_id">
                    </el-option>
                </el-select>
            </el-col>


            <el-col :md="4">
                <el-button :loading="isLoading" @click="searchUser()" :disabled="studentNameFilter == ''" size="small"
                    style="width: 100%;" type="danger">Search</el-button>
            </el-col>

        </el-row>


        <hr>
        <v-client-table filterable="true" :columns="columns" :data="users">

            <div slot="action" slot-scope="props" class="py-1">

                <el-button @click="deleteUser(props.row.id)" size="small" type="danger">Delete</el-button>
            </div>
        </v-client-table>

    </el-card>

</div>
{%endblock%}



{%block script%}
<!-- import Vue before Element -->


<style>
    .semipolar-spinner,
    .semipolar-spinner * {
        box-sizing: border-box;
    }

    .semipolar-spinner {


        position: fixed;
        z-index: 999;
        height: 5em;
        width: 5em;
        overflow: visible;
        margin: auto;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
    }

    .semipolar-spinner .ring {
        border-radius: 50%;
        position: absolute;
        border: calc(65px * 0.05) solid transparent;
        border-top-color: #ff1d5e;
        border-left-color: #ff1d5e;
        animation: semipolar-spinner-animation 2s infinite;
    }

    .semipolar-spinner .ring:nth-child(1) {
        height: calc(65px - 65px * 0.2 * 0);
        width: calc(65px - 65px * 0.2 * 0);
        top: calc(65px * 0.1 * 0);
        left: calc(65px * 0.1 * 0);
        animation-delay: calc(2000ms * 0.1 * 4);
        z-index: 5;
    }

    .semipolar-spinner .ring:nth-child(2) {
        height: calc(65px - 65px * 0.2 * 1);
        width: calc(65px - 65px * 0.2 * 1);
        top: calc(65px * 0.1 * 1);
        left: calc(65px * 0.1 * 1);
        animation-delay: calc(2000ms * 0.1 * 3);
        z-index: 4;
    }

    .semipolar-spinner .ring:nth-child(3) {
        height: calc(65px - 65px * 0.2 * 2);
        width: calc(65px - 65px * 0.2 * 2);
        top: calc(65px * 0.1 * 2);
        left: calc(65px * 0.1 * 2);
        animation-delay: calc(2000ms * 0.1 * 2);
        z-index: 3;
    }

    .semipolar-spinner .ring:nth-child(4) {
        height: calc(65px - 65px * 0.2 * 3);
        width: calc(65px - 65px * 0.2 * 3);
        top: calc(65px * 0.1 * 3);
        left: calc(65px * 0.1 * 3);
        animation-delay: calc(2000ms * 0.1 * 1);
        z-index: 2;
    }

    .semipolar-spinner .ring:nth-child(5) {
        height: calc(65px - 65px * 0.2 * 4);
        width: calc(65px - 65px * 0.2 * 4);
        top: calc(65px * 0.1 * 4);
        left: calc(65px * 0.1 * 4);
        animation-delay: calc(2000ms * 0.1 * 0);
        z-index: 1;
    }

    @keyframes semipolar-spinner-animation {
        50% {
            transform: rotate(360deg) scale(0.7);
        }
    }
</style>

<script>

    Vue.use(VueTables.ClientTable);
    ELEMENT.locale(ELEMENT.lang.en)
    const inst = axios.create({
        baseURL: '/bccapi',
        timeout: 10000,
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': Cookies.get('csrftoken')
        }
    })
    new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data() {
            return {
                columns: ["id", "student_id", "first_name", "last_name",
                    "action"
                ],
                datas: [],
                studentNameFilter: '',
                datastoFilter: [],
                isLoading: false,
                loadingSearch: false,

                students: [],
                users: []
            }
        },
        methods: {
            deleteUser(id) {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then(async (result) => {
                    console.log('here=========')
                    if (result.isConfirmed) {
                        await inst.delete(
                            `users/${id}/`,
                        );
                        Swal.fire(
                            'Deleted!',
                            'The user has been deleted.',
                            'success'
                        )
                        this.users = []
                    }
                })
            },

            getFullname(item) {
                return `${item.student_id}-${item.last_name}, ${item.first_name} ${item.middle_name}`
            },


            async searchStudent(query) {
                if (query !== '') {
                    let res = await axios.get(
                        `/Api/StudentList?search=${query}`
                    );
                    this.students = res.data
                }
            },
            async searchUser() {
                if (this.studentNameFilter !== '') {
                    let res = await axios.get(
                        `/Api/UserList?search=${this.studentNameFilter}`
                    );
                    this.users = res.data
                }
            },



        },

        created() {





        },
    })
</script>
{%endblock%}

</html>